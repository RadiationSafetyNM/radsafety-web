---
import DashboardLayout from "../layouts/DashboardLayout.astro";
import Icon from "../components/Icon.astro";

// Mock Data for Resources (Eventually from Supabase or Content Collection)
// Mock Data for Resources (Eventually from Supabase or Content Collection)
const resources = [
    {
        id: 1,
        title: "ë°©ì‚¬ì„ ë¶„ì•¼ ì •ê¸°ê²€ì‚¬ ìˆ˜ê²€ê°€ì´ë“œ",
        version: "2022ë…„ ê°œì • ìµœì¢…ë³¸",
        category: "ê°€ì´ë“œë¶",
        date: "2022-12-01",
        author: "í•œêµ­ì›ìë ¥ì•ˆì „ê¸°ìˆ ì›(KINS)",
        authority: "KINS",
        description:
            "ë°©ì‚¬ì„ ì•ˆì „ê´€ë¦¬ ì •ê¸°ê²€ì‚¬ ìˆ˜ê²€ì„ ìœ„í•œ ê³µì‹ ê°€ì´ë“œë¼ì¸ì…ë‹ˆë‹¤. ì£¼ìš” ì ê²€ í•­ëª©ê³¼ ì ˆì°¨ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.",
        tags: ["#ì •ê¸°ê²€ì‚¬", "#KINS", "#ê°€ì´ë“œ"],
        fileSize: "PDF",
        isNew: false,
        previewUrl:
            "/radsafety/archive/ë°©ì‚¬ì„ ë¶„ì•¼ ì •ê¸°ê²€ì‚¬ìˆ˜ê²€ê°€ì´ë“œ(2022ë…„ ê°œì •)_ìµœì¢…ë³¸.pdf",
        downloadUrl:
            "/radsafety/archive/ë°©ì‚¬ì„ ë¶„ì•¼ ì •ê¸°ê²€ì‚¬ìˆ˜ê²€ê°€ì´ë“œ(2022ë…„ ê°œì •)_ìµœì¢…ë³¸.pdf",
        type: "pdf",
    },
    {
        id: 101,
        title: "ì•ˆì „ê´€ë¦¬ê·œì • ì‘ì„±ì§€ì¹¨",
        version: "2024.12.31 ê³ ì‹œ ë°˜ì˜",
        category: "ê°€ì´ë“œë¶",
        date: "2024-12-31",
        author: "ì›ìë ¥ì•ˆì „ìœ„ì›íšŒ",
        authority: "NSSC",
        description:
            "ì›ìë ¥ì•ˆì „ë²• ì‹œí–‰ê·œì¹™ ë° ê´€ë ¨ ê³ ì‹œì— ë”°ë¥¸ ì•ˆì „ê´€ë¦¬ê·œì • ì‘ì„± ê¸°ì¤€ ë° í•„ìˆ˜ í¬í•¨ ì‚¬í•­ì„ ê¸°ìˆ í•œ ì§€ì¹¨ì…ë‹ˆë‹¤.",
        tags: ["#ì•ˆì „ê´€ë¦¬ê·œì •", "#ê·œì •ì‘ì„±", "#ì¸í—ˆê°€"],
        fileSize: "PDF",
        isNew: true,
        previewUrl: "/radsafety/archive/ì•ˆì „ê´€ë¦¬ê·œì •_ì‘ì„±ì§€ì¹¨.pdf",
        downloadUrl: "/radsafety/archive/ì•ˆì „ê´€ë¦¬ê·œì •_ì‘ì„±ì§€ì¹¨.pdf",
        type: "pdf",
    },
    {
        id: 102,
        title: "ì•ˆì „ê´€ë¦¬ê·œì • ì˜ˆì‹œ (ì˜ë£Œê¸°ê´€)",
        version: "v1.0",
        category: "ì„œì‹",
        date: "2024-01-01",
        author: "KINS",
        authority: "KINS",
        description:
            "ì˜ë£Œê¸°ê´€ì„ ìœ„í•œ ì•ˆì „ê´€ë¦¬ê·œì • ì‘ì„± ì˜ˆì‹œì…ë‹ˆë‹¤. ë³‘ì› íŠ¹ì„±ì— ë§ê²Œ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.",
        tags: ["#ì˜ë£Œê¸°ê´€", "#ê·œì •ì˜ˆì‹œ", "#ì„œì‹"],
        fileSize: "PDF",
        isNew: false,
        previewUrl: "/radsafety/archive/ì•ˆì „ê´€ë¦¬ê·œì •_ì˜ˆì‹œ.pdf",
        downloadUrl: "/radsafety/archive/ì•ˆì „ê´€ë¦¬ê·œì •_ì˜ˆì‹œ.pdf", // Assuming source is same or similar for now
        type: "pdf",
    },
    {
        id: 3,
        title: "ë°©ì‚¬ì„ ì‘ì—…ì¢…ì‚¬ì êµìœ¡ì¼ì§€ ì–‘ì‹",
        version: "í‘œì¤€ì–‘ì‹",
        category: "ì„œì‹",
        date: "2023-12-20",
        author: "ê´€ë¦¬ì",
        authority: "Society",
        description:
            "ë²•ì • ì˜ë¬´ êµìœ¡ ì´ìˆ˜ ë‚´ìš©ì„ ê¸°ë¡í•˜ê¸° ìœ„í•œ í‘œì¤€ ì–‘ì‹ì…ë‹ˆë‹¤. (ë¯¸ë¦¬ë³´ê¸°ëŠ” PDF, ë‹¤ìš´ë¡œë“œëŠ” HWP)",
        tags: ["#êµìœ¡", "#ì¼ì§€", "#HWP"],
        fileSize: "45KB",
        isNew: false,
        previewUrl: "#", // Needs PDF version
        downloadUrl: "#", // Needs HWP version
        type: "file",
        fileType: "HWP",
    },
    {
        id: 5,
        title: "ì›ìë ¥ì•ˆì „ë²• ì£¼ìš” ê°œì •ì‚¬í•­ ìš”ì•½",
        version: "2023 í•˜ë°˜ê¸°",
        category: "ë²•ë ¹ì •ë³´",
        date: "2023-10-10",
        author: "ê´€ë¦¬ì",
        authority: "Society",
        description:
            "2023ë…„ í•˜ë°˜ê¸°ì— ê°œì •ëœ ì›ìë ¥ì•ˆì „ë²•ì˜ ì£¼ìš” ë‚´ìš©ì„ ìš”ì•½í•˜ì˜€ìŠµë‹ˆë‹¤.",
        tags: ["#ë²•ë ¹", "#ê°œì •ì‚¬í•­", "#ìš”ì•½"],
        fileSize: "1.1MB",
        isNew: false,
        previewUrl: "#",
        downloadUrl: "#",
        type: "file",
        fileType: "PDF",
    },
];

const categories = ["ì „ì²´", "ê°€ì´ë“œë¶", "ì„œì‹", "ë²•ë ¹ì •ë³´", "ì•ˆë‚´ë¬¸"];
---

<DashboardLayout title="ìë£Œì‹¤">
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Filter Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap; /* Wrap tags like Inspection Findings */
            /* overflow-x: auto; Remove scrolling */
            /* padding-bottom: 0.5rem; Not needed if not scrolling */
        }
        .tab-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1.25rem;
            border-radius: 99px;
            font-size: 0.9rem;
            color: var(--text-muted);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .tab-btn.active,
        .tab-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 1.5rem;
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        #resourceSearch {
            width: 100%;
            box-sizing: border-box;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            font-size: 0.95rem;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: 99px;
            box-shadow: 0 1px 2px var(--shadow-color);
            color: var(--text-main);
            transition: border-color 0.2s;
        }
        #resourceSearch:focus {
            outline: none;
            border-color: var(--accent);
        }
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
            display: flex;
        }

        /* List Styles */
        .resource-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .resource-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition:
                transform 0.2s,
                box-shadow 0.2s;
            cursor: pointer;
            box-shadow: 0 1px 2px var(--shadow-color);
        }
        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }

        .card-left {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .file-icon-area {
            width: 40px;
            height: 40px;
            background: var(--bg-body);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .resource-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .resource-category {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: 600;
            display: inline-block;
            margin-bottom: 0.1rem;
        }

        .resource-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-main);
            line-height: 1.4;
        }

        .resource-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .meta-details {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .authority-badge {
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            margin-right: 0.5rem;
            vertical-align: middle;
            color: white;
            background: #9ca3af;
        }
        .authority-badge.kins {
            background: #0ea5e9;
        } /* Sky Blue */
        .authority-badge.nssc {
            background: #2563eb;
        } /* Blue */
        .authority-badge.society {
            background: #10b981;
        } /* Green */

        .version-tag {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: normal;
            margin-left: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.1rem 0.3rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .resource-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin: 0.25rem 0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .tag-row {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            margin-bottom: 0.2rem;
        }
        .meta-tag {
            background: var(--bg-body);
            color: var(--text-muted);
            padding: 0.1rem 0.4rem;
            border-radius: 99px;
            font-size: 0.75rem;
        }

        .file-type-badge {
            font-size: 0.7rem;
            color: #2563eb;
            font-weight: 700;
            border: 1px solid rgba(37, 99, 235, 0.2);
            padding: 0 0.3rem;
            border-radius: 4px;
        }

        .new-badge {
            background: #ef4444;
            color: white;
            font-size: 0.65rem;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .download-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .download-btn:hover {
            background: var(--bg-body);
            color: var(--accent);
        }

        @media (max-width: 640px) {
            .resource-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .card-left {
                width: 100%;
            }
            .download-btn {
                width: 100%;
                text-align: center;
                background: var(--bg-body);
                border-radius: 6px;
                padding: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
        }
    </style>

    <div class="page-header">
        <div class="page-title">
            <Icon name="document-text" size="28" /> ìë£Œì‹¤
        </div>
        <!-- Maybe Admin Upload Button later -->
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <input
            type="text"
            id="resourceSearch"
            placeholder="ìë£Œ ê²€ìƒ‰ (ì˜ˆ: ê°€ì´ë“œ, ì„œì‹, 2024)"
            aria-label="ìë£Œ ê²€ìƒ‰"
        />
        <span class="search-icon"><Icon name="search" size="18" /></span>
    </div>

    <div
        id="noResults"
        style="display: none; text-align: center; padding: 2rem; color: var(--text-muted);"
    >
        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
    </div>

    <!-- Category Tabs -->
    <div class="tabs">
        {
            categories.map((cat, idx) => (
                <button class={`tab-btn ${idx === 0 ? "active" : ""}`}>
                    {cat}
                </button>
            ))
        }
    </div>

    <div class="resource-list">
        {
            resources.map((item) =>
                resources.map((item) => (
                    <div
                        class="resource-card"
                        onclick={`if(event.target.closest('.download-btn')) return; 
                             ${
                                 item.previewUrl && item.previewUrl !== "#"
                                     ? `window.open('${item.previewUrl}', '_blank')`
                                     : `alert('ë¯¸ë¦¬ë³´ê¸°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\\nì˜¤ë¥¸ìª½ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.');`
                             }`}
                    >
                        <div class="card-left">
                            <div class="file-icon-area">
                                <Icon name="document" size="20" />
                            </div>
                            <div class="resource-info">
                                <div>
                                    <span
                                        class={`authority-badge ${item.authority?.toLowerCase() || "society"}`}
                                    >
                                        {item.authority === "KINS"
                                            ? "KINS"
                                            : item.authority === "NSSC"
                                              ? "ì›ì•ˆìœ„"
                                              : "í•™íšŒ"}
                                    </span>
                                    <span class="resource-category">
                                        {item.category}
                                    </span>
                                    {item.isNew && (
                                        <span class="new-badge">N</span>
                                    )}
                                </div>

                                <div class="resource-title">
                                    {item.title}
                                    {item.version && (
                                        <span class="version-tag">
                                            ver: {item.version}
                                        </span>
                                    )}
                                </div>

                                {item.description && (
                                    <div class="resource-desc">
                                        {item.description}
                                    </div>
                                )}

                                <div class="resource-meta">
                                    {item.tags && item.tags.length > 0 && (
                                        <div class="tag-row">
                                            {item.tags.map((tag) => (
                                                <span class="meta-tag">
                                                    {tag}
                                                </span>
                                            ))}
                                        </div>
                                    )}
                                    <div class="meta-details">
                                        <span>ğŸ“… {item.date}</span>
                                        <span>â€¢</span>
                                        <span>ğŸ’¾ {item.fileSize}</span>
                                        {item.fileType && (
                                            <span class="file-type-badge">
                                                {item.fileType}
                                            </span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Explicit Download Action */}
                        <a
                            href={item.downloadUrl}
                            class="download-btn"
                            download={item.downloadUrl !== "#"}
                            target={
                                item.downloadUrl !== "#" ? "_blank" : "_self"
                            }
                            onclick={
                                item.downloadUrl === "#"
                                    ? "event.preventDefault(); event.stopPropagation(); alert('ë‹¤ìš´ë¡œë“œ íŒŒì¼ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');"
                                    : "event.stopPropagation();"
                            }
                            aria-label="Download"
                        >
                            <Icon name="download" size="20" />
                        </a>
                    </div>
                )),
            )
        }
    </div>

    <script>
        document.addEventListener("astro:page-load", () => {
            initResources();
        });

        if (document.readyState !== "loading") {
            initResources();
        }

        function initResources() {
            const searchInput = document.getElementById("resourceSearch");
            const tabBtns = document.querySelectorAll(".tab-btn");
            const cards = document.querySelectorAll(".resource-card");
            const noResults = document.getElementById("noResults");

            let currentCategory = "ì „ì²´";
            let currentSearch = "";

            function filterItems() {
                let hasVisible = false;

                cards.forEach((card) => {
                    const title =
                        card
                            .querySelector(".resource-title")
                            ?.textContent.toLowerCase() || "";
                    const category =
                        card.querySelector(".resource-category")?.textContent ||
                        "";
                    // Using text content searching is adequate for small lists
                    const matchSearch =
                        title.includes(currentSearch) ||
                        category.toLowerCase().includes(currentSearch);
                    const matchCategory =
                        currentCategory === "ì „ì²´" ||
                        category === currentCategory;

                    if (matchSearch && matchCategory) {
                        card.style.display = "flex";
                        hasVisible = true;
                    } else {
                        card.style.display = "none";
                    }
                });

                if (noResults) {
                    noResults.style.display = hasVisible ? "none" : "block";
                }
            }

            // Tab Logic
            tabBtns.forEach((btn) => {
                btn.addEventListener("click", () => {
                    tabBtns.forEach((b) => b.classList.remove("active"));
                    btn.classList.add("active");
                    currentCategory = btn.textContent.trim();
                    filterItems();
                });
            });

            // Search Logic
            if (searchInput) {
                searchInput.addEventListener("input", (e) => {
                    currentSearch = e.target.value.toLowerCase().trim();
                    filterItems();
                });
            }

            // Download Placeholder (Handled Inline)
        }
    </script>
</DashboardLayout>
