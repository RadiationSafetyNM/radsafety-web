---
import Icon from "./Icon.astro";
const { pathname } = Astro.url;

// Navigation Items
const navItems = [
    { name: "홈", path: "/", icon: "home" },
    { name: "수검준비", path: "/inspection-prep", icon: "check-square" },
    {
        name: "지적권고사례",
        path: "/findings-recommendations",
        icon: "alert-circle",
    },
    { name: "자료실", path: "/resources", icon: "folder" },
    { name: "의견보내기", path: "#", icon: "mail" },
];

const isActive = (path) => {
    if (path === "/") return pathname === "/" || pathname === "";
    return pathname.startsWith(path);
};
---

<nav class="mobile-bottom-nav">
    {
        navItems.map((item) =>
            item.path === "#" ? (
                <div
                    class="nav-item feedback-trigger"
                    role="button"
                    style="cursor: pointer;"
                >
                    <div class="icon-container">
                        <Icon name={item.icon} size="24" />
                    </div>
                    <span class="label">{item.name}</span>
                </div>
            ) : (
                <a
                    href={item.path}
                    class={`nav-item ${isActive(item.path) ? "active" : ""}`}
                >
                    <div class="icon-container">
                        <Icon name={item.icon} size="24" />
                    </div>
                    <span class="label">{item.name}</span>
                </a>
            ),
        )
    }
</nav>

<script is:inline>
    function initFeedbackAlert() {
        const triggers = document.querySelectorAll(".feedback-trigger");
        triggers.forEach((trigger) => {
            // Remove existing listener to avoid duplicates
            trigger.onclick = () => {
                alert(
                    "의견보내기는 현재 개발 중입니다.\nkimbi.kirams@gmail.com으로 연락 부탁드립니다.",
                );
            };
        });
    }

    initFeedbackAlert();
    document.addEventListener("astro:after-swap", initFeedbackAlert);
</script>

<style>
    .mobile-bottom-nav {
        display: none; /* Hidden on Desktop */
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(28, 28, 28, 0.95); /* Dark Translucent */
        backdrop-filter: blur(10px);
        border-top: 1px solid #333;
        z-index: 100;
        justify-content: space-around;
        align-items: center;
        padding-bottom: env(safe-area-inset-bottom);
        box-sizing: content-box;
    }

    .nav-item {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-decoration: none;
        color: #888;
        transition: color 0.2s;
        -webkit-tap-highlight-color: transparent;
    }

    .nav-item.active {
        color: #3b82f6; /* Accent Blue */
    }

    .nav-item.active .icon-container {
        transform: translateY(-2px);
    }

    .icon-container {
        margin-bottom: 2px;
        transition: transform 0.2s;
    }

    .label {
        font-size: 0.65rem;
        font-weight: 500;
    }

    @media (max-width: 768px) {
        .mobile-bottom-nav {
            display: flex;
        }
    }
</style>
