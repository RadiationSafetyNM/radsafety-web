---
import BaseHead from "../components/BaseHead.astro";
import Sidebar from "../components/Sidebar.astro";
import MobileBottomNav from "../components/MobileBottomNav.astro";
import Icon from "../components/Icon.astro";
import Footer from "../components/Footer.astro"; // Optional: We might simplify footer in dashboard
import PWAInstall from "../components/PWAInstall.astro";
import { ViewTransitions } from "astro:transitions";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";

const { title, description, scale } = Astro.props;
---

<!doctype html>
<html lang="ko">
    <head>
        <BaseHead
            title={title ? `${title} - ${SITE_TITLE}` : SITE_TITLE}
            description={description || SITE_DESCRIPTION}
            scale={scale}
        />
        <ViewTransitions />
        <style>
            body {
                margin: 0;
                padding: 0;
                background-color: var(--bg-body);
                min-height: 100vh;
            }
            .dashboard-grid {
                display: grid;
                grid-template-columns: 60px 1fr;
                min-height: 100vh;
            }

            main {
                grid-column: 2; /* Force content to second column */
                min-width: 0; /* Prevent grid blowout */
            }

            .content-area {
                padding: 2rem;
                max-width: 1200px;
                margin: 0 auto;
                width: 100%;
                box-sizing: border-box;
            }

            /* Mobile Header */
            .mobile-header {
                display: none;
                background: #1c1c1c;
                color: white;
                padding: 1rem;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 40;
            }
            .hamburger {
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0;
                margin-right: 1rem;
            }

            @media (max-width: 768px) {
                .dashboard-grid {
                    grid-template-columns: 1fr;
                }
                main {
                    grid-column: 1; /* Reset for mobile */
                }
                .mobile-header {
                    display: flex;
                }
                .content-area {
                    padding: 1rem;
                }
                /* Overlay for sidebar when open */
                .sidebar-overlay {
                    display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 45;
                }
                .sidebar-overlay.active {
                    display: block;
                }
            }
        </style>
    </head>
    <body>
        <!-- Mobile Header (Simplified: Just Brand & Bell) -->
        <div class="mobile-header">
            <span style="font-weight:bold; font-size:1.1rem; flex:1;"
                >{SITE_TITLE}</span
            >
            <a
                href="/radsafety/notifications"
                style="color:white; position:relative;"
            >
                <Icon name="bell" size="24" />
                <span
                    class="global-noti-dot"
                    style="position:absolute; top:0; right:0; width:8px; height:8px; background:#ef4444; border-radius:50%;"
                ></span>
            </a>
        </div>

        <div class="dashboard-grid">
            <!-- Sidebar (Desktop Only now) -->
            <Sidebar />

            <!-- Main Content -->
            <main transition:animate="slide">
                <div class="content-area">
                    <slot />
                </div>
                <div style="height: 80px;"></div>
                <!-- Spacer for Bottom Nav -->
            </main>
        </div>

        <MobileBottomNav />
        <!-- <PWAInstall /> -->

        <script>
            // Mobile Menu Toggle - REMOVED (Replaced by Bottom Nav)
            // const menuBtn = document.getElementById("menuBtn");
            // const sidebar = document.querySelector(".sidebar");
            // const overlay = document.getElementById("sidebarOverlay");

            // function toggleMenu() {
            //     sidebar?.classList.toggle("open");
            //     overlay?.classList.toggle("active");
            // }

            // menuBtn?.addEventListener("click", toggleMenu);
            // overlay?.addEventListener("click", toggleMenu);
        </script>
    </body>
</html>
